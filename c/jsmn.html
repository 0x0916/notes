<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>C Code: 一个简单的JSON解析程序</title>
    <link rel=stylesheet href="site.css">
  </head>
  <body>
    <div class="example" id="jsmn">
      <h2><a href="./">C Code</a>: 一个简单的JSON解析程序</h2>
	
      	<div class="summary">
		<p>在资源非常受限的计算机系统上，解析<code>JSON</code>时，我们需要一个不依赖于第三方库的，非常简单的解析方法，通过搜索
找到了一个名称为<code>JSMN</code>的程序。</p>

<p>该程序非常简单，其主页地址为<a href="http://zserge.com/jsmn.html">http://zserge.com/jsmn.html</a>。其特点如下</p>

<ul>
<li>simple</li>
<li>higly portable</li>
<li>no dependencies(even libc!)</li>
<li>no dynamic memory allocation</li>
<li>extremely small code footprint</li>
<li>API has only 2 functions</li>
<li>incremental single-pass parsing</li>
</ul>

<p>正是由于其非常简单，只有两个<code>API</code>，所以使用起来得花费一些时间。本文就简单介绍一下几个示例用法。</p>

<p>以下示例中，我们使用如下的<code>json</code>字符串。</p>

<pre><code class="language-json">{
  &quot;defaultAction&quot;: &quot;SCMP_ACT_ERRNO&quot;,
  &quot;architectures&quot;: [
    &quot;SCMP_ARCH_X86_64&quot;,
    &quot;SCMP_ARCH_X86&quot;,
    &quot;SCMP_ARCH_X32&quot;
  ],
  &quot;syscalls&quot;: [
    {
      &quot;name&quot;: &quot;write&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;
    },
    {
      &quot;name&quot;: &quot;socketcall&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;,
      &quot;args&quot;: [
        {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
      ]
    }
  ]
}
</code></pre>

<h2>示例0: JSMN解除后的数据结构</h2>

<p>上面的<code>json</code>字符串<a href="https://github.com/0x0916/notes/tree/master/code/c/jsmn/jsnm-internal">解析完成</a>，其在<code>JSMN</code>的内部表示如下：</p>

<pre><code>[0] size = 3, type = object
[0] content = {
  &quot;defaultAction&quot;: &quot;SCMP_ACT_ERRNO&quot;,
  &quot;architectures&quot;: [
    &quot;SCMP_ARCH_X86_64&quot;,
    &quot;SCMP_ARCH_X86&quot;,
    &quot;SCMP_ARCH_X32&quot;
  ],
  &quot;syscalls&quot;: [
    {
      &quot;name&quot;: &quot;write&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;
    },
    {
      &quot;name&quot;: &quot;socketcall&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;,
      &quot;args&quot;: [
        {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
      ]
    }
  ]
}
[1] size = 1, type = string
[1] content = defaultAction
[2] size = 0, type = string
[2] content = SCMP_ACT_ERRNO
[3] size = 1, type = string
[3] content = architectures
[4] size = 3, type = array
[4] content = [
    &quot;SCMP_ARCH_X86_64&quot;,
    &quot;SCMP_ARCH_X86&quot;,
    &quot;SCMP_ARCH_X32&quot;
  ]
[5] size = 0, type = string
[5] content = SCMP_ARCH_X86_64
[6] size = 0, type = string
[6] content = SCMP_ARCH_X86
[7] size = 0, type = string
[7] content = SCMP_ARCH_X32
[8] size = 1, type = string
[8] content = syscalls
[9] size = 2, type = array
[9] content = [
    {
      &quot;name&quot;: &quot;write&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;
    },
    {
      &quot;name&quot;: &quot;socketcall&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;,
      &quot;args&quot;: [
        {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
      ]
    }
  ]
[10] size = 2, type = object
[10] content = {
      &quot;name&quot;: &quot;write&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;
    }
[11] size = 1, type = string
[11] content = name
[12] size = 0, type = string
[12] content = write
[13] size = 1, type = string
[13] content = action
[14] size = 0, type = string
[14] content = SCMP_ACT_ALLOW
[15] size = 3, type = object
[15] content = {
      &quot;name&quot;: &quot;socketcall&quot;,
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;,
      &quot;args&quot;: [
        {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
      ]
    }
[16] size = 1, type = string
[16] content = name
[17] size = 0, type = string
[17] content = socketcall
[18] size = 1, type = string
[18] content = action
[19] size = 0, type = string
[19] content = SCMP_ACT_ALLOW
[20] size = 1, type = string
[20] content = args
[21] size = 2, type = array
[21] content = [
        {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
      ]
[22] size = 4, type = object
[22] content = {
          &quot;index&quot;: 0,
          &quot;value&quot;: 1,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
[23] size = 1, type = string
[23] content = index
[24] size = 0, type = primitive
[24] content = 0
[25] size = 1, type = string
[25] content = value
[26] size = 0, type = primitive
[26] content = 1
[27] size = 1, type = string
[27] content = valueTwo
[28] size = 0, type = primitive
[28] content = 0
[29] size = 1, type = string
[29] content = op
[30] size = 0, type = string
[30] content = SCMP_CMP_EQ
[31] size = 4, type = object
[31] content = {
          &quot;index&quot;: 1,
          &quot;value&quot;: 17,
          &quot;valueTwo&quot;: 0,
          &quot;op&quot;: &quot;SCMP_CMP_EQ&quot;
        }
[32] size = 1, type = string
[32] content = index
[33] size = 0, type = primitive
[33] content = 1
[34] size = 1, type = string
[34] content = value
[35] size = 0, type = primitive
[35] content = 17
[36] size = 1, type = string
[36] content = valueTwo
[37] size = 0, type = primitive
[37] content = 0
[38] size = 1, type = string
[38] content = op
[39] size = 0, type = string
[39] content = SCMP_CMP_EQ
</code></pre>

<h2>示例1: Dump <code>json</code></h2>

<p>以上<code>json</code>字符串<a href="https://github.com/0x0916/notes/tree/master/code/c/jsmn/jsnm-dump">dump的结果</a>如下：</p>

<pre><code>'defaultAction': 'SCMP_ACT_ERRNO'
'architectures':
   - 'SCMP_ARCH_X86_64'
   - 'SCMP_ARCH_X86'
   - 'SCMP_ARCH_X32'

'syscalls':
   -
    'name': 'write'
    'action': 'SCMP_ACT_ALLOW'

   -
    'name': 'socketcall'
    'action': 'SCMP_ACT_ALLOW'
    'args':
       -
        'index': 0
        'value': 1
        'valueTwo': 0
        'op': 'SCMP_CMP_EQ'

       -
        'index': 1
        'value': 17
        'valueTwo': 0
        'op': 'SCMP_CMP_EQ'
</code></pre>

<h2>示例2:</h2>

<p>对于我们已知的JSON数据结构，如果简答，我们可以去解析，<a href="https://github.com/0x0916/notes/tree/master/code/c/jsmn/jsnm-simple">例如</a>。</p>

<h2>示例3:</h2>

<p>对于我们已知的JSON数据结构，我们可以使用<a href="https://github.com/0x0916/notes/tree/master/code/c/jsmn/jsnm-parser">状态机进行解析</a>。</p>

      	</div>
	
      
	<div class="pager">
      
      <p class="prev">
        Prev: <a href="no-new-privs.html">NO_NEW_PRIVS总结</a>.
      </p>
      
      
      <p class="next">
        Next: <a href="backtrace.html">程序自我DEBUG方法</a>.
      </p>
      
	</div>
      <p class="footer">
	by <a href="https://github.com/0x0916">@0x0916</a> | <a href="mailto:w@laoqinren.net">联系我</a>
      </p>
    </div>
  </body>
</html>
